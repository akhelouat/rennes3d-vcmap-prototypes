
function loadCss(href) {
  return new Promise((resolve, reject) => {
    const elem = document.createElement('link');
    elem.rel = 'stylesheet';
    elem.href = href;
    elem.defer = false;
    elem.async = false;
    elem.onload = resolve;
    elem.onerror = reject;
    document.head.appendChild(elem);
  });
} await loadCss('data:text/css;base64,Lm1heC1oZWlnaHRbZGF0YS12LTM4MjBjOWI2XXttYXgtaGVpZ2h0OjUwJX0K');import{createToggleAction as V,WindowSlot as D,ButtonLocation as x}from"../../assets/ui.js";import{inject as _,ref as c,nextTick as T,onUnmounted as A}from"../../assets/vue-composition-api.js";import{VcsButton as C}from"../../assets/uicomponents.js";import{getObjectFromClassRegistry as O}from"../../assets/core.js";import{VSheet as j,VVirtualScroll as B,VListItem as R,VListItemContent as E,VListItemTitle as I,VListItemSubtitle as L,VDialog as p,VCard as m,VForm as g,VTextarea as h,VBtn as v,VSelect as w,VTextField as F}from"../../assets/vuetify.js";var J=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t(j,[t("span",{staticClass:"pa-1 mb-2",on:{click:function(a){a.stopPropagation(),e.open=!e.open}}},[t("span",{staticClass:"headline"},[e._v(" "+e._s(e.categoryName)+" ")]),t("span",{staticClass:"float-right"},[t("vcs-button",{attrs:{icon:"$vcsPlus"},on:{click:function(a){e.dialog=!0}}}),t("vcs-button",{attrs:{icon:"mdi-download"},on:{click:e.download}}),t("a",{ref:"link",attrs:{href:e.downloadLink,target:"_blank",download:"category.json"}})],1)]),e.open?t(B,{attrs:{"item-height":"44px",height:6*44,items:e.category,bench:6,width:"100%"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.item;return[t(R,{key:r.name,staticClass:"mb-1"},[t(E,[t(I,{staticClass:"subtitle-1"},[e._v(e._s(r.name))]),t(L,[e._v(e._s(r.type))])],1)],1)]}}],null,!1,4167922884)}):e._e(),t(p,{model:{value:e.dialog,callback:function(a){e.dialog=a},expression:"dialog"}},[t(m,[t(g,{on:{submit:function(a){return a.preventDefault(),e.addItem.apply(null,arguments)}}},[t(h,{model:{value:e.jsonString,callback:function(a){e.jsonString=a},expression:"jsonString"}}),t(v,{attrs:{type:"submit"}},[e._v("Add")])],1)],1)],1)],1)},M=[],oe="";function b(e,o,t,a,r,l,d,s){var n=typeof e=="function"?e.options:e;o&&(n.render=o,n.staticRenderFns=t,n._compiled=!0),a&&(n.functional=!0),l&&(n._scopeId="data-v-"+l);var i;if(d?(i=function(u){u=u||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!u&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(u=__VUE_SSR_CONTEXT__),r&&r.call(this,u),u&&u._registeredComponents&&u._registeredComponents.add(d)},n._ssrRegister=i):r&&(i=s?function(){r.call(this,(n.functional?this.parent:this).$root.$options.shadowRoot)}:r),i)if(n.functional){n._injectStyles=i;var S=n.render;n.render=function(N,f){return i.call(f),S(N,f)}}else{var y=n.beforeCreate;n.beforeCreate=y?[].concat(y,i):[i]}return{exports:e,options:n}}const P={name:"CategoryComponent",components:{VcsButton:C},props:{categoryName:{type:String,required:!0}},setup(e){const o=_("vcsApp"),t=o.categories.getByKey(e.categoryName),a=c(!1),r=c(`{
}`),l=c([]),d=c(""),s=c(!0);return t&&(l.value=[...t.collection].map(n=>({name:n.name,type:n.className||"Object"}))),{dialog:a,category:l,jsonString:r,downloadLink:d,open:s,async addItem(){try{const n=JSON.parse(r.value);t.classRegistryName?t.collection.add(O(o[t.classRegistryName],n)):t.collection.add(n),l.value=[...t.collection].map(i=>({name:i.name,type:i.className||"Object"})),r.value=`{
}`}catch{console.error("invalid JSON")}a.value=!1},download(){const n=JSON.stringify(t.serializeForContext(o.dynamicContextId),null,2);d.value=`data:text/json;charset=utf-8,${encodeURIComponent(n)}`,d.value&&T(()=>{this.$refs.link.click()})}}}},k={};var U=b(P,J,M,!1,q,"c26caa7a",null,null);function q(e){for(let o in k)this[o]=k[o]}var z=function(){return U.exports}(),W=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",[t("div",{staticClass:"overflow-auto"},e._l(e.categories,function(a){return t("Category",{key:a,attrs:{"category-name":a}})}),1),t("hr"),t("span",[t("VcsButton",{attrs:{icon:"$vcsPlus"},on:{click:function(a){e.newDialog=!0}}}),t("VcsButton",{attrs:{icon:"$vcsExport"},on:{click:function(a){e.uploadDialog=!0}}})],1),t(p,{model:{value:e.newDialog,callback:function(a){e.newDialog=a},expression:"newDialog"}},[t(m,{staticClass:"pa-2"},[t(g,{on:{submit:function(a){return a.preventDefault(),e.add.apply(null,arguments)}}},[t(w,{attrs:{items:["Category","AppBackedCategory"]},model:{value:e.newCategory.type,callback:function(a){e.$set(e.newCategory,"type",a)},expression:"newCategory.type"}}),e.newCategory.type==="category.AppBackedCategory"?t(w,{attrs:{items:e.appBackedCollectionNames,placeholder:"Collection Name"},model:{value:e.newCategory.collectionName,callback:function(a){e.$set(e.newCategory,"collectionName",a)},expression:"newCategory.collectionName"}}):t(F,{model:{value:e.newCategory.name,callback:function(a){e.$set(e.newCategory,"name",a)},expression:"newCategory.name"}}),t(v,{attrs:{type:"submit"}},[e._v(" Add ")])],1)],1)],1),t(p,{model:{value:e.uploadDialog,callback:function(a){e.uploadDialog=a},expression:"uploadDialog"}},[t(m,[t(g,{on:{submit:function(a){return a.preventDefault(),e.upload.apply(null,arguments)}}},[t(h,{model:{value:e.uploadString,callback:function(a){e.uploadString=a},expression:"uploadString"}}),t(v,{attrs:{type:"submit"}},[e._v(" Upload ")])],1)],1)],1)],1)},X=[],se="";const H={name:"CategoriesComponent",components:{Category:z,VcsButton:C},setup(){const e=_("vcsApp"),o=c([...e.categories].map(s=>s.name)),t=c(!1),a=c(!1),r=c(""),l=c({name:"new",type:"Category",collectionName:null}),d=[e.categories.added.addEventListener(()=>{o.value=[...e.categories].map(s=>s.name)}),e.categories.removed.addEventListener(()=>{o.value=[...e.categories].map(s=>s.name)})];return A(()=>{d.forEach(s=>{s()})}),{categories:o,newDialog:t,newCategory:l,uploadDialog:a,uploadString:r,appBackedCollectionNames:["layers","maps","plugins","viewpoints","styles"],async add(){const{value:s}=l;s.type==="AppBackedCategory"&&(s.name=s.collectionName),await e.categories.requestCategory(s),l.value={name:"new",type:"category.Category",collectionName:null},t.value=!1},async upload(){var s;try{const n=JSON.parse(r.value);if(!n.name){console.error("must provide name");return}await e.categories.requestCategory({name:n.name,type:"Category"}),((s=n==null?void 0:n.items)==null?void 0:s.length)>0&&await e.categories.parseCategoryItems(n.name,n.items,e.dynamicContextId),r.value="",a.value=!1}catch{console.error("not a valid JSON")}}}}},$={};var K=b(H,W,X,!1,G,"3820c9b6",null,null);function G(e){for(let o in $)this[o]=$[o]}var Q=function(){return K.exports}();async function Y(){return{name:"@vcmap/categoryTest",onVcsAppMounted(e){const{action:o,destroy:t}=V({name:"Category Editor",icon:"$vcsPen"},{id:"category-editor",component:Q,slot:D.DETACHED,position:{width:500}},e.windowManager,"@vcmap/categoryTest");e.navbarManager.add({id:"category-editor",location:x.TOOL,action:o},"@vcmap/categoryTest"),this._destroyAction=t},destroy(){this._destroyAction&&(this._destroyAction(),this._destroyAction=null)}}}export{Y as default};
